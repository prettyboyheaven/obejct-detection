(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{28:function(t,e,a){t.exports=a(73)},33:function(t,e,a){},72:function(t,e,a){},73:function(t,e,a){"use strict";a.r(e);var r=a(6),n=a.n(r),i=a(22),o=a.n(i),s=(a(33),a(25)),c=a(13),h=a(23),l=a(26),g=a(24),u=a(27),d=a(7),w=a.n(d),y=(a(72),"https://pp.userapi.com/c850436/v850436154/1054bc/Grf6sgUxIco.jpg"),f=function(t){function e(){var t,a;Object(c.a)(this,e);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(a=Object(l.a)(this,(t=Object(g.a)(e)).call.apply(t,[this].concat(n)))).state={canvasHeight:450,canvasWidth:700,isDrawing:!1,startDrawingPositionX:null,startDrawingPositionY:null,groups:[],ratio:null,scale:null,naturalScale:null,cords:[{width:0,height:0,x:0,y:0}]},a.handleGetData=function(){var t=a.state,e=t.ratio,r=t.shiftX,n=t.shiftY,i=[],o=function t(e,a,r,n){Object(c.a)(this,t),this.x=e,this.y=a,this.width=r,this.height=n};a.state.groups.forEach(function(t){var a=t.getClientRect(),s=a.x,c=a.y,h=a.width,l=a.height;i.push(new o(Math.round((s-r)/e),Math.round((c-n)/e),Math.round(h/e),Math.round(l/e)))}),console.log(JSON.stringify(i)),a.setState({cords:i})},a.calculateAspectRatioFit=function(t,e,r,n){a.setState({ratio:Math.min(r/t,n/e)});var i=a.state.ratio;return{width:t*i,height:e*i}},a.calculateScale=function(t,e){var r=a.state,n=r.canvasWidth,i=r.canvasHeight;a.setState({scale:Math.min(n/t,i/e)})},a}return Object(u.a)(e,t),Object(h.a)(e,[{key:"componentDidMount",value:function(){var t=this,e=this.state,a=e.canvasHeight,r=e.canvasWidth;this.stage=new w.a.Stage({container:"container",width:r,height:a}),this.layer=new w.a.Layer;var n=new Image;n.onload=function(e){var i=e.target.naturalHeight,o=e.target.naturalWidth,s=t.calculateAspectRatioFit(o,i,r,a);t.calculateScale(s.width,s.height);var c=s.width*t.state.scale,h=s.height*t.state.scale;t.setState({shiftX:r/2-c/2,shiftY:a/2-h/2});var l=t.state,g=l.shiftX,u=l.shiftY,d=new w.a.Image({x:g,y:u,image:n,width:s.width,height:s.height});t.layer.add(d),t.layer.draw()},n.src=y,this.stage.on("click",function(e){e.target.hasName("rect")||(t.stage.find("Transformer").destroy(),t.layer.draw())}),this.stage.on("mousedown",function(e){console.log(e.evt),e.target.hasName("rect")||(t.setState({isDrawing:!0,startDrawingPositionX:e.evt.layerX,startDrawingPositionY:e.evt.layerY}),t.group=new w.a.Group({x:e.evt.layerX,y:e.evt.layerY,draggable:!0,name:"group"}),t.group.on("dragmove",function(t){var e=t.target.getChildren(function(t){return"Rect"===t.getClassName()})[0],n=e.attrs.width,i=e.attrs.height,o=t.target.attrs.x,s=t.target.attrs.y,c=s+i;o+n>=r&&(t.target.attrs.x=r-n),o<=0&&(t.target.attrs.x=0),s<0&&(t.target.attrs.y=0),c>=a&&(t.target.attrs.y=a-i)}),t.rect=new w.a.Rect({x:0,y:0,width:0,height:0,fill:"rgba(255, 255, 255, 0.7)",stroke:"black",overflow:"hidden",cursor:"pointer",strokeWidth:2,name:"rect"}),t.layer.draw(),t.setState({groups:[].concat(Object(s.a)(t.state.groups),[t.group])}),t.state.groups.forEach(function(e){return e.on("click",function(a){if(t.stage.find("Transformer").destroy(),!a.target.attrs.image){var r=t.state.groups.filter(function(t){return t._id===a.target.parent._id})[0],n=new w.a.Transformer({node:r,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"]});return r.on("transformend",function(t){console.log(t.target)}),t.layer.add(n),void t.layer.draw()}t.setState({groups:t.state.groups.filter(function(t){return t._id!==e._id})}),t.stage.find("Transformer").destroy(),e.remove(),t.layer.draw()})}),t.group.add(t.rect),t.layer.add(t.group),t.group.draw())}),this.stage.on("mousemove",function(e){e.cancelBubble=!0;var a={x:e.evt.layerX,y:e.evt.layerY},r={x:t.state.startDrawingPositionX,y:t.state.startDrawingPositionY};t.state.isDrawing&&function(e){a={x:e.x,y:e.y};var n=function(t,e){var a,r=t.x,n=t.y,i=e.x,o=e.y;return r>i&&(a=Math.abs(r-i),i=(r=i)+a),n>o&&(a=Math.abs(n-o),o=(n=o)+a),{x1:r,y1:n,x2:i,y2:o}}(r,a);t.group.x(n.x1),t.group.y(n.y1),t.rect.width(n.x2-n.x1),t.rect.height(n.y2-n.y1),t.rect.visible(!0),t.layer.draw()}({x:e.evt.layerX,y:e.evt.layerY})}),this.stage.on("mouseup",function(){var e=t.rect.attrs;(Math.abs(e.height)<20||Math.abs(e.width)<20)&&(t.setState({groups:t.state.groups.filter(function(e){return e._id!==t.group._id})}),t.group.remove(),t.layer.draw());var a=new Image;a.onload=function(){var e=new w.a.Image({x:15,y:5,image:a,width:50,height:50});t.group.add(e),t.layer.draw()},a.src="https://upload.wikimedia.org/wikipedia/ru/4/49/%D0%9F%D0%BE%D0%BA%D0%B5%D0%BC%D0%BE%D0%BD_%D0%98%D0%B2%D0%B8.png",t.setState({isDrawing:!1,startDrawingPositionX:null,startDrawingPositionY:null})}),this.stage.add(this.layer)}},{key:"render",value:function(){var t=this.state.cords;return[n.a.createElement("div",{key:"1",id:"container",style:{border:"5px solid black",width:"700px",height:"450px",margin:"25px 0"}}),n.a.createElement("button",{onClick:this.handleGetData,key:"2"},"get rects"),n.a.createElement("div",{key:"3",className:"container",style:{position:"relative"}},n.a.createElement("img",{src:y,alt:""}),t.map(function(t,e){return n.a.createElement("div",{key:e,style:{height:t.height,width:t.width,top:t.y,left:t.x,position:"absolute",background:"rgba(0, 255, 2, 0.7)"}})}))]}}]),e}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(f,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[28,1,2]]]);
//# sourceMappingURL=main.b8338e81.chunk.js.map